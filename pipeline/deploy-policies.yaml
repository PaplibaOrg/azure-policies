trigger:
  branches:
    include:
      - main
  paths:
    include:
      - policies/**
      - modules/**
      - pipeline/**

pool: default

variables:
  serviceConnectionDev: 'id-policy-vending-eus-dev-001'
  # serviceConnectionTest: 'id-policy-vending-eus-test-001'
  # serviceConnectionProd: 'id-policy-vending-eus-prod-001'

stages:
  # Dev Environment - Plan and Apply
  - template: templates/deploy-terraform.yaml
    parameters:
      serviceConnection: $(serviceConnectionDev)
      environment: 'Dev'
      workingDirectory: 'policies'
      resourceType: 'Policy'
      resourceDisplayName: 'Policies'
      runPlanInApply: false

  # # Test Environment - Plan, Approval, Apply
  # - template: templates/deploy-terraform.yaml
  #   parameters:
  #     serviceConnection: $(serviceConnectionTest)
  #     environment: 'Test'
  #     workingDirectory: 'policies'
  #     resourceType: 'Policy'
  #     resourceDisplayName: 'Policies'
  #     runPlanInApply: false

  # # Prod Environment - Plan, Approval, Apply
  # - template: templates/deploy-terraform.yaml
  #   parameters:
  #     serviceConnection: $(serviceConnectionProd)
  #     environment: 'Prod'
  #     workingDirectory: 'policies'
  #     resourceType: 'Policy'
  #     resourceDisplayName: 'Policies'
  #     runPlanInApply: false
